#!/usr/bin/env bash

SAMPLES=$(/bin/ls -1d zr*)
# SAMPLES="zr6254_1"

for SAMPLE in ${SAMPLES}; do
  echo Processing quality for ${SAMPLE}

  R --vanilla >/dev/null 2>&1 <<EOF
library(ggplot2)
library(ggthemes)
library(tidyverse)

qual <- read_tsv('./${SAMPLE}/${SAMPLE}_vcfstats.lqual', col_names=TRUE)

median_qual <- qual %>%
  pull(QUAL) %>%
  sort() %>%
  median(na.rm = FALSE)

plt <- ggplot(data=qual, mapping=aes(x=POS,y=QUAL)) +
  geom_smooth() +
  theme_hc() +
  ggtitle("Sample ${SAMPLE} quality") +
  geom_hline(yintercept = median_qual, color="purple")

png("quality/${SAMPLE}.quality.png")
print(plt)
EOF
done
